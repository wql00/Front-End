<!DOCTYPE html>
<html>
    <head>
        <title>学术会议管理平台</title>
        <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    </head>
    <body>
        <!--Navigation导航栏部分-->
        <div>
            <nav class="navbar navbar-default" role="navigation">
                <br/> 
                <div class="container-fluid">
                    <div class="navbar-header" style="margin-left: 20%">
                        <a class="navbar-brand" href="#">学术会议管理平台</a>
                    </div>
                    <div class="hidden-sm hidden-xs" style="margin-right: 10%">
                        <form class="navbar-form navbar-left" style="margin-left: 10%">
                                <div class="form-group">
                                    <select class="form-control">
                                            <option>按时间</option>
                                            <option>按地区</option>
                                            <option>主办方</option>
                                            <option>按名称</option>
                                        </select>  
                                    <input type="text" class="form-control" placeholder="查找会议">
                                    <button type="submit" class="btn btn-default">查找</button>
                                </div>
                        </form>
                    </div>
                    <div>
                        <div id="navbar">
                            <ul class="nav navbar-nav" style="margin-left: 20%">
                                <li class="dropdown">
                                    <a class="dropdown-toggle " data-toggle="dropdown" role="button" href="#">
                                    游客 <span class="caret"></span>
                                    </a>
                                    <ul class="dropdown-menu" role="menu" aria-labelledby="drop">
                                        <li><a id="LogIn" href="#" data-toggle="modal" data-target="#userlogin">登录</a></li>
                                        <li class="divider"></li>
                                        <li><a id="SignIn" href="Navigation.html">注册</a></li>
                                        <li class="divider"></li>
                                        <li><a id="LogOut"href="#" onclick="logout">登出</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div> 
                    </div>
                </div>  
                <br/>   
            </nav>
        </div>
        <!--Navigation导航栏结束-->
        <!--注册部分-->
        <div>
            <div class="modal-body" style="margin-left:25%">
                <div class="col-md-6" style="margin:opx auto">
                    <br>
                    <div class="form-group">
                        <label for="username1" class="col-sm-2 control-label">昵称：</label>
                        <div class="col-sm-10">
                        <input class="form-control required" type="text" placeholder="Nickname" id="username1" name="username" autofocus maxlength="20"/>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div class="form-group">
                        <label for="useremail" class="col-sm-2 control-label">邮箱：</label>
                        <div class="col-sm-10">
                        <input class="form-control required" type="email" placeholder="Email" id="username1" name="username" autofocus maxlength="20"/>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div class="form-group">
                        <label for="password1" class="col-sm-2 control-label">密码：</label>
                        <div class="col-sm-10">
                        <input class="form-control required" type="password" placeholder="Password" id="password1" name="password" autofocus maxlength="20"/>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div class="form-group">
                        <label for="repassword" class="col-sm-2 control-label">确认密码：</label>
                        <div class="col-sm-10">
                        <input class="form-control required" type="password" placeholder="Confirm Password" id="repassword1" name="repassword" autofocus maxlength="20"/>
                        </div>
                    </div>
                    <br>
                    <br>
                    <br>
                    <br>
                    <div class="form-group col-md-offset-10">
                        <button id='btn' type="submit" class="btn btn-primary" name="submit" onclick="doPostRegister()">确认注册</button>
                    </div>
                </div>
            </div>
        </div>
        <!--注册部分结束-->
        <!--登录部分-->
        <div class="modal fade" id="userlogin" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content" style="margin-top:40%">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">登录</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-horizontal col-md-offset-0" id="login_form">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <i class="fa fa-user fa-lg">昵称</i>
                                    <input class="form-control required" type="text" placeholder="Nickname" id="username" name="username" autofocus maxlength="20"/>
                                </div>
                                <div class="form-group">
                                    <i class="fa fa-lock fa-lg">密码</i>
                                    <input class="form-control required" type="password" placeholder="Password" id="password" name="password" maxlength="20"/>
                                </div>
                                <div class="form-group" >
                                    <font color="#999999">还没有账号？</font><a href="Navigation.html" color="#CCCC00">前往注册</a>
                                </div>
                                    <div class="form-group col-md-offset-9">
                                        <button id='btn' type="submit" class="btn btn-success" name="submit" onclick="doPostLogin()">登录</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <div class="modal-footer"></div>
                </div>
            </div>
        </div>
        <!--登录部分结束-->
    </body>
    <script>
        var url="http://154.8.211.55:8081";
    	
		function doPostRegister()
		{
			//alert("qqq");
			var val1 = document.getElementById("username1").value;
            var val2 = document.getElementById("password1").value;
            var val3 = document.getElementById("repassword").value;
			var val4 = document.getElementById("useremail").value;
			var user = {
        	"nickname":val1,
        	"password":val2,
			"email":val4
        	};
			user = JSON.stringify(user);
        	var settings = {
			        type: "POST",
			        url:url+"/personaluser",
			        data:user,
			        error: function(XHR,textStatus,errorThrown) {
			            alert("error!");
						alert(errorThrown);
			        },
			        success: function(data,textStatus) {
						if(data==false)
						{
							alert("该昵称已被注册！");
						}
						else
						{
							alert("注册成功！");
							window.location.href='register.html';
							
						}
			        },
			        headers: {
			            "Content-Type":"application/json"
			        }
			        
			};
			
			if(val1=="")
			{
				alert("昵称不能为空！");
			}
			else if(val2=="")
			{
				alert("密码不能为空！");
			}
			else if(val2!=val3)
			{
				alert("两次输入密码不相同！");
			}
			else if(val4=="")
			{
				alert("邮箱不能为空！");
			}
			else
			{
				 $.ajax(settings);
			}
		}
		function doPostLogin()
		{
			//alert("qqq");
			var val1 = document.getElementById("username").value;
            var val2 = document.getElementById("password").value;
			$.get(url+"/personaluser?username="+val1+"&password="+val2,function(data)
			{
      			if(data==0)
				{
					alert("用户名或密码不正确！");
				}
				else
				{
					var cookie="userId="+data;
					//alert("sss");
					document.cookie = cookie;
					window.location.href="main.html";
				}
			});	
		}
		function uname1()
		{
			var a=checkName();
			$("#uname").append(a);
		}
		function getCookie(c_name){
			if(document.cookie.length>0){
				c_start=document.cookie.indexOf(c_name+"=")
				if(c_start!=-1){
					c_start=c_start+c_name.length+1
					c_end=document.cookie.indexOf(";",c_start)
					if(c_end==-1){
						c_end=document.cookie.length
					}
					return unescape(document.cookie.substring(c_start,c_end))
				}
			}
			return "";
		}
		function checkName()
		{
			var username=getCookie("userId");
			if(username=="")
			{
				document.getElementById("lin").href="#";
				document.getElementById("lout").href="";
				var b="游客";
				return b;
			}
			else
			{
				document.getElementById("lin").href="";
				document.getElementById("lout").href="#";
				var c="";
				$.ajaxSettings.async=false;
				$.get(url+"/username?userId="+username,function(data,status){
				c=data;
				//alert(c);
			});
			return c;
			}
		}
		function logout() 
		{  
   		 setCookie("userId", "", -1);
		 location.reload();
		}  
		function setCookie(cname, cvalue, exdays) 
		{
			var d = new Date();
			d.setTime(d.getTime() + (exdays*24*60*60*1000));
			var expires = "expires="+d.toUTCString();
			document.cookie = cname + "=" + cvalue + "; " + expires;
	    }
		
    </script>
</html>
